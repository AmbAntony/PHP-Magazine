!function(i){i.fn.theiaStickySidebar=function(t){function e(t,e){return!0===t.initialized||(function(t,e){t.initialized=!0,e.each(function(){function e(){r.fixedScrollTop=0,r.sidebar.css({"min-height":"1px"}),r.stickySidebar.css({position:"static",width:"",transform:"none"})}var r={};if(r.sidebar=i(this),r.options=t||{},r.container=r.sidebar.parent(),r.sidebar.parents().css("-webkit-transform","none"),r.sidebar.css({position:"relative",overflow:"visible","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),r.stickySidebar=r.sidebar.find(".theiaStickySidebar"),0==r.stickySidebar.length){var s=/(?:text|application)\/(?:x-)?(?:javascript|ecmascript)/i;r.sidebar.find("script").filter(function(i,t){return 0===t.type.length||t.type.match(s)}).remove(),r.stickySidebar=i("<div>").addClass("theiaStickySidebar").append(r.sidebar.children()),r.sidebar.append(r.stickySidebar)}r.marginBottom=parseInt(r.sidebar.css("margin-bottom")),r.paddingTop=parseInt(r.sidebar.css("padding-top")),r.paddingBottom=parseInt(r.sidebar.css("padding-bottom"));var n=r.stickySidebar.offset().top,a=r.stickySidebar.outerHeight();r.stickySidebar.css("padding-top",1),r.stickySidebar.css("padding-bottom",1),n-=r.stickySidebar.offset().top,a=r.stickySidebar.outerHeight()-a-n,0==n?(r.stickySidebar.css("padding-top",0),r.stickySidebarPaddingTop=0):r.stickySidebarPaddingTop=1,0==a?(r.stickySidebar.css("padding-bottom",0),r.stickySidebarPaddingBottom=0):r.stickySidebarPaddingBottom=1,r.previousScrollTop=null,r.fixedScrollTop=0,e(),r.onScroll=function(t){if(t.stickySidebar.is(":visible")){var r=t.sidebar.outerWidth("none"==t.sidebar.css("float"));if(r+50>t.container.width())return void e();var s=i(document).scrollTop(),n="static";if(s>=t.sidebar.offset().top+t.paddingTop){var a,d=t.paddingTop,c=t.paddingBottom+t.marginBottom,b=t.sidebar.offset().top,p=t.sidebar.offset().top+function(t){var e=t.height();return t.children().each(function(){e=Math.max(e,i(this).height())}),e}(t.container),f=t.stickySidebar.outerHeight()+d+c<i(window).height();a=f?0+t.stickySidebar.outerHeight():i(window).height()-t.marginBottom-t.paddingBottom;var S=b-s+t.paddingTop,u=p-s-t.paddingBottom-t.marginBottom,l=t.stickySidebar.offset().top-s,h=t.previousScrollTop-s;"fixed"==t.stickySidebar.css("position")&&(l+=h),l=h>0?Math.min(l,0):Math.max(l,a-t.stickySidebar.outerHeight()),l=Math.max(l,S),l=Math.min(l,u-t.stickySidebar.outerHeight());var g=t.container.height()==t.stickySidebar.outerHeight();n=!g&&0==l||!g&&l==a-t.stickySidebar.outerHeight()?"fixed":"absolute"}if("fixed"==n){var y=i(document).scrollLeft();t.stickySidebar.css({position:"fixed",width:o(t.stickySidebar)+"px",transform:"translateY("+l+"px)",top:"0px"})}else if("absolute"==n){var k={};"absolute"!=t.stickySidebar.css("position")&&(k.position="absolute",k.transform="translateY("+(s+l-t.sidebar.offset().top-t.stickySidebarPaddingTop-t.stickySidebarPaddingBottom)+"px)",k.top="0px"),k.width=o(t.stickySidebar)+"px",k.left="",t.stickySidebar.css(k)}else"static"==n&&e();"static"!=n&&t.sidebar.css({"min-height":t.stickySidebar.outerHeight()+t.stickySidebar.offset().top-t.sidebar.offset().top+t.paddingBottom}),t.previousScrollTop=s}},r.onScroll(r),i(document).on("scroll.TSS",function(i){return function(){i.onScroll(i)}}(r)),i(window).on("resize.TSS",function(i){return function(){i.stickySidebar.css({position:"static"}),i.onScroll(i)}}(r)),"undefined"!=typeof ResizeSensor&&new ResizeSensor(r.stickySidebar[0],function(i){return function(){i.onScroll(i)}}(r))})}(t,e),!0)}function o(i){var t;try{t=i[0].getBoundingClientRect().width}catch(i){}return void 0===t&&(t=i.width()),t}return function(t,o){e(t,o)||(i(document).on("scroll.TSS",function(t,o){return function(r){e(t,o)&&i(this).unbind(r)}}(t,o)),i(window).on("resize.TSS",function(t,o){return function(r){e(t,o)&&i(this).unbind(r)}}(t,o)))}(t=i.extend(t),this),this}}(jQuery);