// +------------------------------------------------------------------------+
// | @author Oscar Garc√©s (SoyVillareal)
// | @author_url 1: https://soyvillareal.com
// | @author_url 2: https://github.com/soyvillareal
// | @author_email: hi@soyvillareal.com   
// +------------------------------------------------------------------------+
// | PHP Magazine - The best digital magazine for newspapers or bloggers
// | Licensed under the MIT License. Copyright (c) 2022 PHP Magazine.
// +------------------------------------------------------------------------+
(function(){var e,t,a,n,i,r=$("#header-fixed"),o=$("#btn-hfshare"),d=$("#hfshare-modal"),s=$("body"),l=paper_p.post_url,c=l;i=function(e){var t=$(e).children().first();t.addClass("copied"),setTimeout(function(){t.removeClass("copied")},300)},o.click(function(){d.toggleClass("hidden"),r.css("height","auto"),o.attr("aria-expanded",!$.parseJSON(o.attr("aria-expanded")))}),$(document).click(function(e){$(e.target).parents().is("#btn-hfshare")||$(e.target).parents().is("#hfshare-modal .item-share")||(d.addClass("hidden"),r.removeAttr("style"))}).on("click",".btn_clink",function(){var e,t,a,n=$(this),r=$(n).attr("data-link"),o=document.body.createTextRange;o||window.getSelection?(e=$("<div>"),s.append(e.text(r||c)),o?(t=document.body.createTextRange(),t.moveToElementText(e[0]),t.select()):(a=window.getSelection(),t=document.createRange(),t.selectNodeContents(e[0]),a.removeAllRanges(),a.addRange(t))):(e=$("<input>"),s.append(e.val(r||c)),e.select()),document.execCommand("copy"),i(n),e.remove()}),e=r.find(".btn_save"),t=[paper_p.post_id],a=function(e,t){e.attr("disabled",t)},n=function(e,t){a(e.addClass("spinner-is-loading"),t)},function(){var e=$("#alert-pdelete"),t=$("#btn-pdelete");JSON.parse(paper_p.loggedin)&&($(document).on("click",".btn_save",function(){var e=$(this),t=e.attr("data-id"),n=$(".btn_save[data-id="+t+"]"),i=n.find("path"),r=0,o=0;a(n,!0),$.post(paper_p.url.save+"?token="+paper_p.token,{post_id:t},function(t){if(console.log(t),200==t.S){if("delete"==t.AC)i.attr("fill","none"),n.attr("aria-checked",!1),a(n,!1);else{var d=e.siblings(".content_saved");d.addClass("saved-animation-image"),clearTimeout(r),r=setTimeout(function(){i.attr("fill","currentColor"),n.attr("aria-checked",!0),d.removeClass("saved-animation-image"),n.addClass("saved-animation-button"),clearTimeout(o),o=setTimeout(function(){n.removeClass("saved-animation-button"),a(n,!1)},100)},600)}n.blur()}})}).on("click",".btn_dalert",function(){s.addClass("overflow-hidden"),e.removeClass("hidden"),t.attr("data-id",$(this).attr("data-id"))}),$("#btn-pcancel").click(function(){s.removeClass("overflow-hidden"),e.addClass("hidden"),t.removeAttr("data-id")}),t.click(function(){var e=$(this);n(e,!0),$.post(paper_p.url.delete+"?token="+paper_p.token,{post_id:e.attr("data-id")},function(t){200==t.S?window.location=t.LK:a(e.removeClass("spinner-is-loading"),!1)})}))}(),function(){var a,n,i,l,c=$("#posts"),p=$("#spinner-load"),h=$("#header").height(),m=0,f=0,u=!0,v=!1,g=!0;$(document).scroll(function(){var _=$(window).scrollTop(),C=1==$(a).length?parseInt((_-a.offset().top)/a.height()*100):0,k=C<=0?0:C;$("#header-progress").css("width",k+"%"),_<m?(k<=1&&null!=t[f-1]&&(f--,v=!0),_<=h&&(g=!0,d.addClass("hidden"),r.removeAttr("style"),o.attr("aria-expanded",!1),s.removeClass("header-fixed"))):(_+$(window).height()-c.offset().top>=c.height()-100&&t[f]==t[t.length-1]&&u&&(u=!1,p.removeClass("hidden"),$.post(paper_p.url.load+"?token="+paper_p.token,{category_id:paper_p.category_id,post_ids:JSON.stringify(t)},function(e){200==e.S?(c.append(e.HT),t.push(e.ID),u=!0,p.addClass("hidden")):p.addClass("hidden")})),k>=99&&null!=t[f+1]&&(f++,v=!0),_>=h&&g&&(g=!1,s.addClass("header-fixed"))),m=_<=0?0:_,a=$("#post-"+t[f]),n=a.find(".btn_save"),e.attr("aria-checked",n.attr("aria-checked")).attr("data-id",n.attr("data-id")).find("path").attr("fill",n.find("path").attr("fill")),v&&(i=a.find(".post-title"),l=i.parent(),v=!1,r.find("img").attr("src",a.find(".post-thumbnail img").attr("src")).attr("title",i.text()),r.find(".item-header-title").text(i.text()),"A"==l.prop("tagName")&&l.attr("href"),a.find(".item-share").each(function(e){$(d.find(".item-share a")[e]).attr("href",$(this).find("a").attr("href"))})),$(".item-post").each(function(){var e=$(this),t=e.find(".content-sticky"),a=e.offset().top;_>=a-30?(t.addClass("sticky"),_>=a+e.height()-(t.height()+100)?t.removeClass("sticky").css({bottom:0,top:"auto"}):t.addClass("sticky").removeAttr("style")):t.removeClass("sticky").removeAttr("style")})})}(),function(){var e=$("#alert-preport"),t=e.find(".text-error"),i=e.find(".item_rtextarea"),r=$("#item-acontent"),o=$("#alert-spalert"),d=$("#item-ralert"),l=$("#alert-rtitle"),c=$("#item-abuttons"),p=$("#btn-rsend"),h=$(".item_rinput"),m=$("li.item_rcomment"),f=$("li.item_rpost"),u=function(){var t=$(window).height()-85,a=$(".item_rinput:checked ~ .content_description"),n=t-(l.height()+c.height());n<r.children().height()-(a.length>0?a.height():0)?(d.css("height",t),e.css("top","calc(50% - "+t/2+"px)"),r.css("height",n)):v()},v=function(){r.removeAttr("style"),d.removeAttr("style"),e.removeAttr("style")},g=function(){e.addClass("hidden"),h.prop("checked",!1),i.val("")},_=function(e){return $(e).addClass("color-grey").removeClass("color-blue")};"on"==paper_p.settings.nodejs&&SOCKET.on("setOutpreaction",function(e){if(200==e.S){var t=$(e.AB?e.AB:e.DB);e.DO&&$(e.DO).find(".item_likedis").text(e.CO),t.find(".item_likedis").text(e.CR)}}),$(document).on("click",".btn_plike, .btn_pdislike",function(){var e=$(this),t=function(t){console.log(t),200==t.S?(t.DO&&_($(t.DO)).find(".item_likedis").text(t.CO),e.find(".item_likedis").text(t.CR),t.DB&&_($(t.DB)),t.AB&&$(t.AB).removeClass("color-grey").addClass("color-blue"),a(e.removeClass("spinner-is-loading"),!1)):a(e.removeClass("spinner-is-loading"),!1)};n(e,!0),"off"==paper_p.settings.nodejs?$.post(paper_p.url.post_reaction+"?token="+paper_p.token,{post_id:e.attr("data-id"),type:e.attr("data-type")},t):SOCKET.emit("setInpreaction",{post_id:e.attr("data-id"),type:e.attr("data-type")},t)}).on("click",".btn_report",function(){var t=$(this),a=t.attr("data-place"),n=paper_p.word.report_comment;"post"==a?(n=paper_p.word.report_post,f.removeClass("hidden"),m.addClass("hidden")):(m.removeClass("hidden"),f.addClass("hidden")),l.children().text(n),s.addClass("overflow-hidden"),e.removeClass("hidden"),p.attr("data-id",t.attr("data-id")).attr("data-place",a),v(),u()}),$("#btn-rcancel").click(function(){g(),v(),s.removeClass("overflow-hidden"),e.addClass("hidden"),a(p.removeAttr("data-id"),!0),t.text("")}),$("#btn-spclose").click(function(){o.addClass("hidden"),s.removeClass("overflow-hidden")}),p.click(function(){var e=$(this),i=e.attr("data-place"),r=$(".item_rinput:checked"),d=r.parent(),s=d.find(".item_rtextarea"),l=e.attr("data-id"),c=r.val(),p={reported_id:l,type:c,place:i};s.length>0&&(p={reported_id:l,type:c,place:i,description:s.val()}),t.text(""),a(h,!0),n(e,!0),$.post(paper_p.url.report+"?token="+paper_p.token,p,function(n){200==n.S?(g(),o.removeClass("hidden"),e.removeClass("spinner-is-loading"),a(h,!1)):(t.text(n.E),a(e.removeClass("spinner-is-loading"),!1),a(h,!1),u())})}),h.change(function(){$(".item_rinput:checked")&&a(p,!1),t.text(""),i.val("").next().find(".text_count").text(0),u()}),i.on("keyup, input",function(){var e=$(this),t=e.parent(),a=t.find(".text_count"),n=a.parent(),i=e.val(),r=i.length,o=paper_p.settings.max_words_report;r>.8*o?n.addClass("color-red").removeClass("color-green color-orange"):r>.5*o?n.addClass("color-orange").removeClass("color-red color-green"):n.addClass("color-green").removeClass("color-red color-orange"),a.text(r),e.val(i.slice(0,o-1))}),$(window).resize(u)}()})(paper_p);