(function(){
   var l = $('#header-fixed'),
       o = $('#btn-hfshare'),
       j = $('#hfshare-modal'),
       b = $('body'),
       a = paper.post_url,
       s = a;

   (function(){
      var w = function(e){
            var k = $(e).children().first();
            k.addClass('copied'), setTimeout(function(){
               k.removeClass('copied');
            }, 300);
          },
          r = function(e){
            var k = $("<input>"),
                y = $(e).attr('data-link');
            $("body").append(k), k.val((y ? y : s)).select(), document.execCommand("copy"), w(e), k.remove();
          },
          c = $('.newsletter_category'),
          q = c.children(),
          v = $('.text_all'),
          m = $('.text_none'),
          d = !0;
      $('.close-newsletter').click(function(){
         $('.newsletter-fixed').addClass('hidden'), $('.personalize_newsletter').removeAttr('style'), b.removeClass('newsletter-personalized-active'), document.cookie = 'dismiss_newsletter=true;max-age=604800;path=/';
      }), $('.newsletter_type').change(function(){
         var k = $(this),
             y = k.parents('.content_newsletter').find('.personalize_newsletter');
         k.val() == 'personalized' ? (y.css('height', y.children().first().height()), b.addClass('newsletter-personalized-active')) : (y.removeAttr('style'), b.removeClass('newsletter-personalized-active'));
      }), c.change(function(e){
         $(this).children().length == $(this).val().length ? (v.addClass('hidden'), m.removeClass('hidden')) : (v.removeClass('hidden'), m.addClass('hidden'));
      }), $('.select_all').click(function(){
         q.prop('selected', d), d = !d, v.toggleClass('hidden'), m.toggleClass('hidden');
      }), o.click(function(){
         j.toggleClass('hidden'), l.css('height', 'auto'), o.attr('aria-expanded', !$.parseJSON(o.attr('aria-expanded')));
      }), $(document).click(function(e){ 
         if (!$(e.target).parents().is('#btn-hfshare') && !$(e.target).parents().is('#hfshare-modal .item-share')){
            j.addClass('hidden'), l.removeAttr('style');
         }
      }).on('click', '.btn-clink', function(){
         navigator.clipboard ? navigator.clipboard.writeText(s).then(w(this)).catch(r(this)) : r(this);
      })
   })();



   (function(){
      var h = l.find('.btn_save'),
          n = [paper.post_id];

      (function(){
         var r = function(e, i){
               e.attr('disabled', i);
             },
             g = $('.btn_newsletter'),
             p = $('.item_place'),
             w,
             m;
         JSON.parse(paper.loggedin) && ($(document).on('click', '.btn_save', function(){
            var t = $(this),
                u = t.attr('data-id'),
                d = $('#post-'+u+' .btn_save'),
                c,
                y;
            d.index(h[0]) == -1 && d.push(h[0]), d.index(t) == -1 && d.push(t), c = t.siblings('.content_saved'), y = d.find('path'), r(d, !0), $.post(paper.url.save+"?token="+paper.token, {'post_id': u, 'post_ids': JSON.stringify(n)}, function(e){
               e.S == 200 && ((e.AC == 'delete' ? (y.attr('fill', 'none'), d.attr('aria-checked', !1), r(d, !1)) : (c.addClass('saved-animation-image'), clearTimeout(w), w = setTimeout(function(){(y.attr('fill', 'currentColor'), d.attr('aria-checked', !0), c.removeClass('saved-animation-image'), t.addClass('saved-animation-button'), clearTimeout(m), m = setTimeout(function(){t.removeClass('saved-animation-button'), r(d, !1)}, 100))}, 600))), d.blur());
            })
         }).on('click', '.btn_delete', function(){
            var v = $(this);
            v.addClass('spinner-is-loading'), r(v, !0), $.post(paper.url.delete+"?token="+paper.token, {'post_id': v.attr('data-id')}, function(e) {
               if(e.S == 200) {
                  window.location = e.LK
               } else (r(v, !1), v.removeClass('spinner-is-loading'), console.log(e.E));
            });
         })), g.click(function(){
            var v = $(this),
                q = v.parent(),
                k = q.find('.newsletter_email'),
                z = k.siblings('.text-error');
            v.addClass('spinner-is-loading'), r(v, !0), $.post(paper.url.subscribe+"?token="+paper.token, {'email': k.val(), 'type': q.find('.newsletter_type').val(), 'frequency': q.find('.newsletter_frequency').val(), 'popular': q.find('.newsletter_popular:checked').val(), 'category': JSON.stringify(q.find('.newsletter_category').val())}, function(e) {
               e.S == 200 ? (r(p, !0), v.removeClass('spinner-is-loading'), z.addClass('color-green').removeClass('color-red').text(e.M), setTimeout(function(){
                   k.removeClass('active'), z.text('').addClass('color-red').removeClass('color-green'), q.find('.personalize_newsletter').removeAttr('style'), $('.content_newsletter').trigger("reset"), r(p, !1), r(v, !1)
               }, 3000)) : (z.text(e.E), k.addClass('border-red').addClass('boxshadow-red'), v.removeClass('spinner-is-loading'));
            });
         }), $('.newsletter_email').on('input', function(){
            var v = $(this);
            v.val() != '' && (v.removeClass('border-red').removeClass('boxshadow-red').siblings('.text-error').text(''), r(g, !1))
         });
      })(), (function(){
         var x = $('#posts'),
             f = $('#spinner-load'),
             y = $('#header').height(),
             v = 0,
             u = 0,
             k = !0,
             d = !1,
             z = !0,
             p,
             g,
             q,
             r;

         $(document).scroll(function(){
            var w = $(window).scrollTop(),
                m = $(p).length == 1 ? parseInt(((w - p.offset().top) / p.height()) * 100) : 0,
                t = m <= 0 ? 0 : m;
            $('#header-progress').css('width', t+'%');
            if(w < v){
               (t <= 1 && n[u-1] != undefined) && (u--, d = !0), w <= y && (z = !0, j.addClass('hidden'), l.removeAttr('style'), o.attr('aria-expanded', !1), b.removeClass('header-fixed'));
            } else {
               if(((w + $(window).height()) - x.offset().top) >= (x.height() - 100)){
                  if(n[u] == n[n.length-1]){
                     k && (k = !1, f.removeClass('hidden'), $.post(paper.url.load+"?token="+paper.token, {'category_id': paper.category_id, 'post_ids': JSON.stringify(n)}, function(e) {e.S == 200 ? (x.append(e.HT), n.push(e.ID), k = !0, f.addClass('hidden')) : f.removeClass('hidden');}));
                  }
               }
               (t >= 99 && n[u+1] != undefined) && (u++, d = !0), w >= y && z && (z = !1, b.addClass('header-fixed'));
            }
            v = w <= 0 ? 0 : w, p = $('#post-'+n[u]), d && (d = !1, q = p.find('.post-title'), g = q.parent(), l.find('img').attr('src', p.find('.post-thumbnail img').attr('src')).attr('title', q.text()), l.find('.item-header-title').text(q.text()), s = g.prop("tagName") == 'A' ? g.attr('href') : a, r = p.find('.btn_save'), h.attr('aria-checked', r.attr('aria-checked')).attr('data-id', r.attr('data-id')).find('path').attr('fill', r.find('path').attr('fill')), p.find('.item-share').each(function(i){
               $(j.find('.item-share a')[i]).attr('href', $(this).find('a').attr('href'));
            }));
            $('.item-post').each(function() {
               var m = $(this),
                   t = m.find('.content-sticky'),
                   c = m.offset().top;
               if (w >= (c - 30)) {
                  t.addClass('sticky');
                  if (w >= (c + m.height() - (t.height() + 100))) {
                     t.removeClass('sticky').css({'bottom': 0, 'top': 'auto'});
                  } else {
                     t.addClass('sticky').removeAttr('style');
                  }
               } else {
                  t.removeClass('sticky').removeAttr('style');
               }
            });
         });
      })()

   })()
})(paper);