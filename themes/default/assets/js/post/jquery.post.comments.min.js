// +------------------------------------------------------------------------+
// | @author Oscar GarcÃ©s (SoyVillareal)
// | @author_url 1: https://soyvillareal.com
// | @author_url 2: https://github.com/soyvillareal
// | @author_email: hi@soyvillareal.com   
// +------------------------------------------------------------------------+
// | PHP Magazine - The best digital magazine for newspapers or bloggers
// | Licensed under the MIT License. Copyright (c) 2022 PHP Magazine.
// +------------------------------------------------------------------------+
(function(){var t,e,n,a,o,i,r,s,d,c,l,p,m,_,u,f,v,h,g=function(t="",e=!1,n=""){var a=$("#content-lnotify");clearTimeout(b),"blue"==n?a.addClass("background-blue").removeClass("background-red"):"red"==n?a.addClass("background-red").removeClass("background-blue"):a.removeClass("background-blue background-red"),a.css("rtl"==paper_p.dir?"right":"left",e?20:"").find("p").text(t),b=setTimeout(function(){g()},5e3)},b=0;t=function(t,e){t.attr("disabled",e)},e=function(e,n){t(e.addClass("spinner-is-loading"),n)},n=function(t){return t.parents(".content_comment")},a=function(t){return t.parents(".content_preply").addClass("hidden").find(".text_carea")},o=function(t,e=!0){t=this==window?t:$(this);var n=$(".btn_coptions[aria-expanded=true]"),a=function(t){return t.attr("aria-expanded",!JSON.parse(t.attr("aria-expanded")))};e&&n.length>0&&a(n),a(t).blur()},i=function(){_.addClass("hidden"),u.removeAttr("data-id")},r=function(){return m.find(".btn_coptions[aria-expanded=true]")},s=function(t,e){var n=t.find("svg"),a=t.siblings(".content_replies, .btn_rload");t.attr("data-type","hide"),e.text(paper_p.word.hide),n.addClass("rotate-180"),a.removeClass("hidden")},d=function(e,a=""){var o=n(e),i=o.find(".content_cprogress"),r=i.next(),s=o.find(".btn_comment, .btn_reply");a?(i.addClass("hidden"),r.removeClass("hidden"),t(s,!0)):(r.addClass("hidden"),i.removeClass("hidden"),t(s,!1)),r.children().text(a)},c=function(t,e,n){t=t.hasClass("text_carea")?t:t.parents(".content_cbuttons").prev();var a=t.next().find(".container_cprogress"),o=a.find("svg");a.attr("aria-valuenow",e),e>70?o.addClass("color-red").removeClass("color-blue color-orange"):e>40?o.addClass("color-orange").removeClass("color-red color-blue"):o.addClass("color-blue").removeClass("color-red color-orange"),a.find("circle").last().attr("stroke-dashoffset",n),d(t)},l=function(t){return t.parents(".container_comments")},p=function(t){return l(t).find(".btn_csortby").val()},m=$(".content_comments"),_=$("#alert-cdelete"),u=$("#btn-cdelete"),f=!0,v=!1,h=!0,"on"==paper_p.settings.nodejs&&SOCKET.on("setOutcreaction",function(t){if(200==t.S){var e=$(t.AB?t.AB:t.DB);t.DO&&$(t.DO).find(".item_likedis").text(t.CO),e.find(".item_likedis").text(t.CR)}}),$(document).on("focus",".text_carea",function(){var t=$(this);0==t.val().length&&t.prop("baseScrollHeight",t.prop("scrollHeight")),n(t).find(".content_cbuttons").removeClass("hidden")}).on("keyup, input",".text_carea",function(){var t=$(this),e=t.val(),n=e.length,a=paper_p.settings.max_words_comments,o=n/a;n<=a?c(t,100*o,100-55*o):d(t,a-n),t.val().length>0&&t.removeClass("border-red"),t.attr("rows",1).attr("rows",1+Math.ceil((t.prop("scrollHeight")-t.prop("baseScrollHeight"))/24))}).on("click",".btn_ccancel",function(){c(n($(this)).find(".content_cbuttons").addClass("hidden").prev().val("").attr("rows",1),0,100)}).on("click",".btn_rcancel",function(){var t=a($(this));t.val("").attr("rows",1),c(t,0,100)}).on("click",".btn_comment",function(n){var a=$(this),o=a.attr("data-id"),i=a.parent(),r=i.prev(),s=l(a),d=s.find(".content_comments"),p=s.find(".content_comment[data-pinned=true]"),m=function(e){console.log(e),200==e.S?(i.addClass("hidden"),r.val("").attr("rows",1),0==p.length?d.prepend(e.HT):p.after(e.HT),a.parents(".post-center").find(".item_comments").text(e.CC),t(a.removeClass("spinner-is-loading"),!1),c(a,0,100)):(t(a.removeClass("spinner-is-loading"),!1),g(e.E,!0,"red"))},_={post_id:o,text:r.val()};if(f){if(""==$.trim(r.val()))return r.val(""),n.preventDefault(),!1;e(a,!0),"off"==paper_p.settings.nodejs?$.post(paper_p.url.comment+"?token="+paper_p.token,_,m):SOCKET.emit("setIncomment",_,m)}}).on("click",".btn_reply",function(){var o=$(this),i=a(o),r=function(e){if(200==e.S){var a=n(o).find(".content_replies").append(e.HT).removeClass("hidden").siblings(".btn_sreplies");i.val("").attr("rows",1),a.find(".item_screplies").text(e.HC),"show"==a.attr("data-type")&&s(a,a.find(".item_streplies")),t(o.removeClass("spinner-is-loading"),!1),c(o,0,100)}else t(o.removeClass("spinner-is-loading"),!1),g(e.E,!0,"red")},d={comment_id:o.attr("data-id"),text:i.val()};f&&(e(o,!0),"off"==paper_p.settings.nodejs?$.post(paper_p.url.reply+"?token="+paper_p.token,d,r):SOCKET.emit("setInreply",d,r))}).on("click",".btn_sreply",function(){var t=$(this),e=t.attr("data-username"),n=t.parents(".item_cr").next(),a=n.find(".text_carea");f&&(n.removeClass("hidden"),setTimeout(function(){a.focus(),paper_p.loggedin&&e&&a.val("@"+e+" ")}))}).on("click",".btn_clike, .btn_cdislike",function(){var n=$(this),a=function(t){return $(t).addClass("color-grey").removeClass("color-blue")},o=function(e){console.log(e),200==e.S?(e.DO&&a($(e.DO)).find(".item_likedis").text(e.CO),n.find(".item_likedis").text(e.CR),e.DB&&a($(e.DB)),e.AB&&$(e.AB).removeClass("color-grey").addClass("color-blue"),t(n.removeClass("spinner-is-loading"),!1)):(t(n.removeClass("spinner-is-loading"),!1),g(e.E,!0,"red"))},i={comment_id:n.attr("data-id"),type:n.attr("data-type"),treact:n.attr("data-treact")};f&&(e(n,!0),"off"==paper_p.settings.nodejs?$.post(paper_p.url.comment_reaction+"?token="+paper_p.token,i,o):SOCKET.emit("setIncrection",i,o))}).on("click",".btn_coptions",o).click(function(t){var e=r();!$(t.target).is(".content_cdown, .content_cdown *")&&e.length>0&&o(e,!1)}).on("click",".btn_scdelete",function(){var t=$(this);f&&(u.attr("data-id",t.attr("data-id")).attr("data-type",t.attr("data-type")),_.removeClass("hidden"),o(r(),!1))}).on("click",".btn_cpin",function(){var a=$(this),o=n(a);f&&(e(a,!0),$.post(paper_p.url.pin+"?token="+paper_p.token,{comment_id:a.attr("data-id"),sort_by:p(a)},function(e){200==e.S?(e.HI&&$(e.HI).replaceWith(e.HO),o.remove(),$("html").animate({scrollTop:m.prepend(e.HT).offset().top-o.find(".item-comment").height()},750)):(t(a.removeClass("spinner-is-loading"),!1),g(e.E,!0,"red"))}))}).on("click",".btn_cunpin",function(){var n=$(this);f&&(e(n,!0),$.post(paper_p.url.unpin+"?token="+paper_p.token,{comment_id:n.attr("data-id")},function(e){200==e.S?$(e.HE).replaceWith(e.HT):(t(n.removeClass("spinner-is-loading"),!1),g(e.E,!0,"red"))}))}).on("click",".btn_rload",function(){var a=$(this),o=n(a),i=[];f&&(o.find(".content_reply").each(function(){i.push($(this).attr("data-id"))}),e(a,!0),$.post(paper_p.url.load_replies+"?token="+paper_p.token,{comment_id:a.attr("data-id"),sort_by:p(a),reply_ids:JSON.stringify(i)},function(e){if(200==e.S){var n=o.find(".content_replies"),i=n.find(".content_reply[data-type=new]");i.length>0?i.before(e.HT):n.append(e.HT),t(a.removeClass("spinner-is-loading"),!1)}else a.remove()}))}).on("click",".btn_cload",function(){var n=$(this),a=n.prev(),o=[];h&&f&&(h=!1,a.children().each(function(){o.push($(this).attr("data-id"))}),e(n,!0),$.post(paper_p.url.load_comments+"?token="+paper_p.token,{post_id:n.attr("data-id"),sort_by:p(n),comment_ids:JSON.stringify(o)},function(e){200==e.S?(a.append(e.HT),t(n.removeClass("spinner-is-loading"),!1),h=!0):(n.addClass("hidden"),v=h=!0)}))}).on("click",".btn_sreplies",function(){var t=$(this),e=t.find("svg"),n=t.siblings(".content_replies, .btn_rload"),a=t.find(".item_streplies");"hide"==t.attr("data-type")?(t.attr("data-type","show"),a.text(paper_p.word.show),e.removeClass("rotate-180"),n.addClass("hidden")):s(t,a)}).on("change",".btn_csortby",function(){var e=$(this),n=function(e,n,a=!0){var o=l(e),i=o.find(".btn_comment"),r=o.find(".content_cspinner").toggleClass("hidden").toggleClass("spinner-is-loading").siblings(".content_comments, .btn_cload").toggleClass("hidden");return t(e,n),t(i,n),t(i.parent().prev(),n),v&&a&&(t($(r[1]).removeClass("spinner-is-loading hidden"),!1),v=!1),o};f&&(f=!1,n(e,!0,!1),$.post(paper_p.url.sort_comments+"?token="+paper_p.token,{post_id:paper_p.post_id,sort_by:e.val()},function(t){200==t.S?(f=!0,n(e,!1).find(".content_comments").html(t.HT)):(f=!0,n(e,!1),g(t.E,!0,"red"))}))}).on("click",".btn_spcomment",function(){$("html").animate({scrollTop:$(".container_comments[data-id="+$(this).attr("data-id")+"]").offset().top-50})}).on("click",".btn_ctchange",function(){var t=$(this),e=l(t),n=t.attr("data-type"),a=e.find(".item_ctsort");"facebook"==n?a.addClass("hidden"):a.removeClass("hidden"),t.parent().find(".btn_ctchange.active").removeClass("active").siblings(":not(.item_ctbackground)").addClass("active"),e.find(".items_comments[data-type="+n+"]").removeClass("hidden").siblings(":not(.item_notab)").addClass("hidden")}),$("#btn-dnotify").click(g),u.click(function(){var n=$(this),a=n.attr("data-type");f&&(e(n,!0),$.post(paper_p.url.delete_comment+"?token="+paper_p.token,{comment_id:n.attr("data-id"),type:a},function(e){200==e.S?($(e.DL).remove(),i(),t(n.removeClass("spinner-is-loading"),!1)):(t(n.removeClass("spinner-is-loading"),!1),g(e.E,!0,"red"))}))}),$("#btn-ccancel").click(i),function(){var t=$("body"),e=document.body.createTextRange;$(document).on("click",".btn_cucopy",function(){var n,a,o,i=$(this).attr("data-link");e||window.getSelection?(n=$("<div>"),t.append(n.text(i)),e?(a=document.body.createTextRange(),a.moveToElementText(n[0]),a.select()):(o=window.getSelection(),a=document.createRange(),a.selectNodeContents(n[0]),o.removeAllRanges(),o.addRange(a))):(n=$("<input>"),t.append(n.val(i)),n.select()),document.execCommand("copy"),n.remove(),g(paper_p.word.link_copied_clipboard,!0,"blue")})}()})(paper_p);