(function(){
	var f = function(e, u){
          e.attr('disabled', u);
          return e;
        },
        s = function(e, u, y){
          e ? e.removeClass('border-red').removeClass('boxshadow-red') : y.removeClass('background-red'), u.text('')
        },
        k = function(e, u, y, r, w = !0){
          e ? e.addClass('border-red').addClass('boxshadow-red') : w && r.addClass('background-red'), u.text(y), g(r)
        },
        g = function(e){
          f(e, !1).removeClass('spinner-is-loading')
        },
        b = function(e, u){
          e.find('.content-placeholder').addClass('hidden'), e.find('.content-image').removeClass('hidden'), e.find('.item_image').html('<img src="'+u+'" alt="Vista previa"/>')
        },
        q = function(){
          var w = $('.btn_post');
          $('.item_key:not(:disabled), .item_change:not(:disabled)').each(function(){
            if(!$(this).hasClass('no_validate') && $(this).val() == '') return f(w, !0), !1; else f(w, !1);
          })
        },
        l = !0;

    (function(){
      $('.btn_post').click(function(e){
        e.preventDefault();
        var y = $(this),
            w = [],
            c = [],
            p = $('.area_validate'),
            j = $('.post_sources'),
            m = $('#post-right'),
            u = m.find('.thumbnail_file')[0].files,
            n = $('.simditor-body'),
            o = $('.item_key:not(.thumbnail_text), .item_change, .extra_shadow, .simditor'),
            a = o.parents('.content-field'),
            d = a.find('.text-error'),
            t = new FormData();

        if(!l) return !1;
        t.append('thumbnail', (u.length == 0 ? (a.find('.item_image img').last().length > 0 ? m.find('.thumbnail_text').val() : '') : u[0])), l = !1, f(p, !0), $('.entry').each(function(e, i){
          var h = $(i),
              x = h.attr('data-type'),
              v = h.find('.thumbnail_text').val(),
              m = h.find('.thumbnail_file'),
              r = [x];
          if(x == 'image'){
            var z = m[0].files;
            t.append('thumbnail_'+e, (z.length == 0 ? (h.find('.item_image img').length > 0 ? v : '') : z[0]))
          }
          h.find('.item_key, .item_change').each(function(a){
            r.push($(this).val()), a == 2 && x == 'image' && m[0].files.length == 0 && (r[2] = v);
          }), w.push(r);
        }), t.append('entries', JSON.stringify(w)), $(j[0]).children().each(function(e, i){
          var i = $(i),
              z = i.find('input'),
              x = $(z[0]).val(),
              h = $(z[1]).val(),
              a = i.parent();
          c.push({'name': x, 'source': h}), s(z, a.next()), e != 0 && x == '' && h == '' && (i.remove()), w = 1, w++, a.find('.item_count').text(w)
        }), t.append('post_sources', JSON.stringify(c)), c = [], $(j[1]).children().each(function(e, i){
          var i = $(i),
              z = i.find('input'),
              x = $(z[0]).val(),
              h = $(z[1]).val(),
              a = i.parent();
          c.push({'name': x, 'source': h}), s(z, a.next()), e != 0 && x == '' && h == '' && (i.remove()), z = 1, z++, a.find('.item_count').text(z)
        }), t.append('thumb_sources', JSON.stringify(c)), t.append('title', $('#title').val()), t.append('category', $('#category').val()), t.append('type', $('#type').val()), t.append('description', $('#description').val()), t.append('tags', $('#tags').val()), t.append('action', y.attr('data-action')), n.attr('contenteditable', !1), s(f(o, !0), d), f(y, !0).addClass('spinner-is-loading'), $.ajax({
          url: paper.url.create_post+"?token="+paper.token,
          type: 'POST',
          data: t,
          contentType: false,
          processData: false,
          success: function(e) {
            if(e.S == 200){
              window.location = e.LK //, g(y), f(p, !1), l = !0
            } else {
              f(o, !1), n.attr('contenteditable', !0), $.isArray(e.E) ? $.each(e.E, function(e, u){
                var i = isNaN(u['EL']),
                    z = i ? $(u['EL']) : $($('.entry')[u['EL']]),
                    x = i ? z.parents('.content-field') : z.find('.content-field'),
                    h = (!isNaN(u['CT']) ? $(j[u['CT']]).parent() : x).find('.text-error'),
                    a = $(j[u['CT']]).children();
                k((i ? (u['SW'] == 0 ? !1 : z) : x.find(u['CS'])), h, u['TX'], y, !1), u['EL'] == '.post_sources' && u['PS'] && a.each(function(e, i){
                  if(u['PS'].indexOf(e) != -1) $(a[e]).find('input:nth-child('+u['FD']+')').addClass('border-red')
                })
              }) : '', f(p, !1), l = !0
            }
          }
        })
      })
    })(), (function(){
      var o = 2,
          z = 2,
          r = $('.btn_asource');
      r.click(function(){
        var w = $(this),
            h = w.attr('data-type'),
            j = h == 'post' ? o : z;

        l && (j < paper.settings.number_of_fonts ? (w.parent().next().find('.post_sources').append('<div class="display-flex direction-row align-center w-100 h-30 margin-t10"><span class="item_count font-bigly icon-z color-blackly margin-l5">'+j+'</span><div class="display-flex w-100"><input class="item-input item_key no_validate w-100 background-white color-black margin-r10 padding-r10 border-bottom border-black border-focus-blue animation-ease3s sizing-box" type="text" placeholder="'+paper.word.name+'"><input class="item-input item_key no_validate w-100 background-white color-black padding-r10 border-bottom border-black border-focus-blue animation-ease3s sizing-box" type="text" placeholder="'+paper.word.link+'"></div><button class="btn_sdelete area_validate display-flex btn-noway background-red margin-l5 border-rlow boxshadow-grey hover-button animation-ease3s" type="button" data-type="'+h+'"><svg class="icon-z color-white" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M 10.091 16.688 L 10.091 9.813 C 10.091 9.721 10.061 9.646 10.001 9.588 C 9.942 9.529 9.866 9.5 9.773 9.5 L 9.136 9.5 C 9.044 9.5 8.967 9.529 8.908 9.588 C 8.848 9.646 8.818 9.721 8.818 9.813 L 8.818 16.688 C 8.818 16.779 8.848 16.854 8.908 16.912 C 8.967 16.971 9.044 17 9.136 17 L 9.773 17 C 9.866 17 9.942 16.971 10.001 16.912 C 10.061 16.854 10.091 16.779 10.091 16.688 Z M 12.636 16.688 L 12.636 9.813 C 12.636 9.721 12.607 9.646 12.547 9.588 C 12.487 9.529 12.411 9.5 12.318 9.5 L 11.682 9.5 C 11.589 9.5 11.513 9.529 11.453 9.588 C 11.393 9.646 11.364 9.721 11.364 9.813 L 11.364 16.688 C 11.364 16.779 11.393 16.854 11.453 16.912 C 11.513 16.971 11.589 17 11.682 17 L 12.318 17 C 12.411 17 12.487 16.971 12.547 16.912 C 12.607 16.854 12.636 16.779 12.636 16.688 Z M 15.182 16.688 L 15.182 9.813 C 15.182 9.721 15.152 9.646 15.092 9.588 C 15.033 9.529 14.956 9.5 14.864 9.5 L 14.227 9.5 C 14.134 9.5 14.058 9.529 13.999 9.588 C 13.939 9.646 13.909 9.721 13.909 9.813 L 13.909 16.688 C 13.909 16.779 13.939 16.854 13.999 16.912 C 14.058 16.971 14.134 17 14.227 17 L 14.864 17 C 14.956 17 15.033 16.971 15.092 16.912 C 15.152 16.854 15.182 16.779 15.182 16.688 Z M 9.773 7 L 14.227 7 L 13.75 5.857 C 13.704 5.799 13.647 5.763 13.581 5.75 L 10.429 5.75 C 10.363 5.763 10.306 5.799 10.26 5.857 Z M 19 7.313 L 19 7.938 C 19 8.029 18.97 8.104 18.911 8.162 C 18.851 8.221 18.775 8.25 18.682 8.25 L 17.727 8.25 L 17.727 17.508 C 17.727 18.048 17.572 18.515 17.26 18.909 C 16.948 19.303 16.574 19.5 16.136 19.5 L 7.864 19.5 C 7.426 19.5 7.052 19.31 6.74 18.929 C 6.429 18.548 6.273 18.087 6.273 17.547 L 6.273 8.25 L 5.318 8.25 C 5.225 8.25 5.149 8.221 5.089 8.162 C 5.03 8.104 5 8.029 5 7.938 L 5 7.313 C 5 7.221 5.03 7.146 5.089 7.088 C 5.149 7.029 5.225 7 5.318 7 L 8.391 7 L 9.087 5.369 C 9.186 5.128 9.365 4.923 9.624 4.754 C 9.882 4.585 10.144 4.5 10.409 4.5 L 13.591 4.5 C 13.856 4.5 14.118 4.585 14.376 4.754 C 14.635 4.923 14.814 5.128 14.913 5.369 L 15.609 7 L 18.682 7 C 18.775 7 18.851 7.029 18.911 7.088 C 18.97 7.146 19 7.221 19 7.313 Z"></path></svg></button></div>'), (h == 'post' ? o++ : z++)) : f(w, !0))
      }), $(document).on('click', '.btn_sdelete', function(e){
        var w = $(this),
            h = w.attr('data-type'),
            d = h == 'post',
            u = w.parents('.post_sources'),
            x = u.children(),
            p = u.find('.btn_sdelete').index(w)+1;
        l && (x[p].remove(), x.length == (p+1) ? (d ? o-- : z--) : ((d ? o = 2 : z = 2), u.find('.item_count').each(function(e, i){
          $(i).text(e+2), (d ? o++ : z++)
        })), f(r, !1))
      })
    })(), (function(){
      var o = $("#content-tags"),
          a = $('#tags'),
          r = $('#new-tag'),
          m = $('#search-tags'),
          c = $('#tag-label'),
          j = 'margin-t5 margin-b5 margin-r5 padding-5',
          i = [],
          n = !1,
          d = function(e){
            e.removeClass("item-tag-active")
          },
          x = function(){
            $('.item_tag').length == 0 && (!r.is(':focus') && c.hasClass('active') && c.removeClass('active'), r.parent().removeClass(j)), !r.is(':focus') && c.removeClass('focus')
          },
          h = function(e) {
            var p = $('.item_tag'),
                w = r.val(),
                u = e ? e : w;
            if(u === '' || i.length >= paper.settings.number_labels) return !1;
            d(p); 
            if(i.indexOf(u) != -1) return $(p[i.indexOf(u)]).addClass("item-tag-active"), !1;
            $('<li class="item_tag display-block position-relative background-blue '+j+' border-rlow border-all"><label class="tag_label color-black"></label><button class="tag_close btn-noway"><svg class="icon-y vertical-sub" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke="#000" stroke-width="2" d="M7,7 L17,17 M7,17 L17,7"/></svg></button></li>').insertBefore(o.find(".tag-new")).find('.tag_label').text(u), r.val('').parent().addClass(j), i.push(u), a.val(i.toString()), q(), z(), s(o, o.next());
          },
          z = function(){
            m.addClass('hidden').html('')
          };
      $('.tag_label').each(function(){
        i.push($(this).text())
      }), a.val(i.toString()), r.on('cut', z).keydown(function(e) {
        var u = $('.item_tag'),
            p = u.last(),
            y = e.which || e.keyCode,
            v = r.val();

        if(!l) return !1;
        d(u) 
        if (y == 8 && v === ''){
          n ? (i.pop(), a.val(i.toString()), p.remove(), x(), q()) : (n = !0, p.addClass("item-tag-active"))
        } else {
          n = !1, m.html('');
        }
        if(y === 188 && e.shiftKey === !1 || y === 13 || y == 9 && v !== '') e.preventDefault(), h()
      }).keyup(function(){
        l && (m.addClass('hidden'), r.val() != '' && $.post(paper.url.get_tags+"?token="+paper.token, {'search': r.val(), 'tags': JSON.stringify(i)}, function(e){
                  e.S == 200 && e.TG === r.val() && m.removeClass('hidden').html(e.HT)
                }))
      }).blur(function(e){
        var w = $(e.relatedTarget),
            v = r.val();
        if(!l) return !1;
        if(w.is('.btn_tag')){
          h($.trim(w.text()))
        } else {
          if(v !== ''){
            if(i.indexOf(v) != -1) return d($('.item_tag')), x(), m.addClass('hidden'), !1;
            h(), x()
          } else x();
        }
      }).focus(function(){
        l && (c.addClass('active').addClass('focus'));
      }), o.click(function(e){
        l && ($(e.target).is('UL') && r.focus())
      }), $(document).click(function(e){
        if(!l) return !1;
        if($(e.target).is('#content-tags, #content-tags *') && m.html() != '') m.removeClass('hidden');
      }).on('click', '.tag_close', function(){
        var w = $(this).parents('.item_tag');
        l && (i.splice($('.item_tag').index(w), 1), a.val(i.toString()), w.remove(), x(), q())
      })
    })(), (function(){
      var t = $('#alert-delete'),
          o = function(e){
            var n = $('.btn_popup[aria-expanded=true] ~ .content-alert-popup'),
                r = n.parents('.content-thumbnail').find('.item-file'),
                y = n.find('.thumbnail_text');
            f(n.prev(), !1).attr('aria-expanded', !1), r.val() != '' || e && f(r, !1), r.removeClass('hidden'), n.addClass('hidden').siblings('.item-placeholder').removeClass('active'), f(y, !0);
          },
          m = function(){
            t.addClass('hidden'), $('body').removeClass('overflow-hidden')
          },
          z;
      $('#btn-acancel').click(m), $('#btn-delete').click(function(){
        l && (z.remove(), m(), q(), $('.entries .entry[data-type=video]').length == 0 && $('#type').val('normal'))
      }), $(document).on('click', '.btn_adelete', function(){
        l && (z = $(this).parents('.entry'), t.removeClass('hidden'), $('body').addClass('overflow-hidden'))
      }).on('click', '.btn_popup', function(){
        var n = $(this);
        l && (o(), n.attr('aria-expanded', !0).blur().next().removeClass('hidden').next().addClass('active'), f(n.siblings('.item-file'), !0).addClass('hidden'), n.next().find('.text-error').text(''), f(n, !0).next().find('input').removeAttr('disabled').focus())
      }).on('click', '.btn_gicancel', function(){
        var n = $(this).parents('.content-placeholder');
        o(!0)
      }).click(function(e){
        var n = $(e.target);
        !n.is('.btn_popup[aria-expanded=true], .btn_popup[aria-expanded=true] *, .btn_popup[aria-expanded=true] ~ .content-alert-popup, .btn_popup[aria-expanded=true] ~ .content-alert-popup *') && o(!0), n.is(t) && m()
      }).on('click', '.btn_gimage', function(){
        var n = $(this),
            w = n.parents('.content-alert-popup'),
            y = w.find('input'),
            u = w.find('.text-error'),
            r = w.parents('.content-thumbnail');
        l && (s(f(y, !0), u), f(n, !0).addClass('spinner-is-loading'), $.post(paper.url.get_image+"?token="+paper.token, {'url': y.val()}, function(e){
                    if(e.S == 200){
                      w.addClass('hidden'), o(), b(r, e.IM), g(n), q(), s(r.find('.item-placeholder'), r.find('.text-error'))
                    } else {
                      k(f(y, !1), u, e.E, n)
                    }
                }))
      })
    })(), (function(){
      $(document).on('keyup', '.item_key', function(){
        var w = $(this),
            o = w.val();
        if(w.siblings('.btn_gvideo').length > 0){
          var z = w.parent().next(),
              a = z.find('.youtube'),
              c = z.find('.dailymotion'),
              d = z.find('.vimeo');
            a.removeClass('active'), c.removeClass('active'), d.removeClass('active'), o.match(/^(?:http(?:s)?:\/\/)?(?:[a-z0-9.]+\.)?(?:youtu\.be|youtube\.com)\/(?:(?:watch)?\?(?:.*&)?v(?:i)?=|(?:embed|v|vi|user)\/)([^\?&\"'>]+)/) ? a.addClass('active') : (o.match(/^.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/) ? c.addClass('active') : o.match(/^(?:http(?:s)?:\/\/)?(?:[a-z0-9.]+\.)?vimeo\.com\/([0-9]+)$/) && d.addClass('active'))
        }
        o != '' ? (w.addClass('active'), s(w, w.next('.text-error'))) : w.removeClass('active'), q()
      }).on('change', '.item_change', function(){
        var w = $(this),
            z = w.prop('type');

        if(z == 'file'){
          var x = w.prop('files');
          if (x && x[0]) {
            var p = new FileReader(),
                u = w.parents('.content-thumbnail'),
                r = u.find('.item-placeholder'),
                h = u.find('.text-error');
            if(p && p.readAsDataURL){
              p.readAsDataURL(x[0]), $(p).on('load', function(){
                b(u, p.result), s(r, h)
              })
            } else if(window.URL.createObjectURL){
              b(u, window.URL.createObjectURL(x[0])), s(r, h)
            }
          }
        }
        q()
      })
    })(), (function(){
      var d = $('.btn_aentry'),
          j = function(){
            $('.text_simditor').each(function(){
              if($(this).parents(".entry").find(".simditor").length == 0){
                Simditor.locale = paper.lang, (new Simditor({
                  textarea: $(this),
                  toolbar: ['title', 'bold', 'italic', 'underline', 'strikethrough', 'fontScale', '|', 'ol', 'ul', 'blockquote', '|', 'link', 'indent', 'outdent', 'alignment'],
                  pasteImage: !0,
                  toolbarFloat: !1
                })).on('valuechanged', function(){
                  this.sync(), q(), s(this.el, this.el.next())
                })
              }
            })
          },
          a = function(e, u, y){
            e.find('.item_title').removeClass('hidden'), u.addClass("hidden").next().addClass('hidden'), u.prev().html(y)
          };

      $(document).on('click', '.btn_esource', function(){
        var w = $(this),
            u = w.children(),
            p = $(u[2]);
        l && (w.prev().toggleClass('hidden'), $(u[0]).toggleClass('hidden'), $(u[1]).toggleClass('hidden'), !p.attr('transform') ? p.attr('transform', 'rotate(180)') : p.removeAttr('transform'))
      }).on('click', '.btn_idelete', function(){
        var w = $(this).parents('.content-thumbnail'),
            u = w.find('.content-alert-popup input'),
            v = w.find('.item-file');

        l && (f(v, !1).val(''), w.find('.content-placeholder').removeClass('hidden'), w.find('.content-image').addClass('hidden'), w.find('.item_image img').remove(), v.val() != '' && f(u, !1), u.val(''), f(w.find('.btn_popup'), !1), q())
      }).on('click', '.btn_repos', function() {
        if(!l) return !1;
        var z = $(this).attr('data-type'),
            x = $(this).parents(".entry");
        z == 'up' ? x.insertBefore(x.prev()) : x.insertAfter(x.next())
      }).on("click", '.btn_gvideo', function(){
        var o = $(this),
            w = o.parents('.entry'),
            u = w.find('.content_get'),
            p = u.find("input"),
            v = w.find('.text-error');

        l && (s(f(p, !0), v), f(o, !0).addClass('spinner-is-loading'), $.post(paper.url.get_frame+"?token="+paper.token, {'url': p.val(), 'type': w.attr('data-type')}, function(e){
                    if(e.S == 200){
                      a(w, u, e.HT), g(o)
                    } else {
                      k(f(p, !1), v, e.E, o)
                    }
                }))
      }).on("click", '.btn_giframe', function(){
        var w = $(this),
            u = w.parents('.entry'),
            v = u.find('.content_get'),
            o = u.find('.text-error'),
            m = v.find("input");
          l && (s(f(m, !0), o), f(w, !0).addClass('spinner-is-loading'), $.post(paper.url.get_frame+"?token="+paper.token, {'url': m.val(), 'type': u.attr('data-type')}, function(e){
                      if(e.S == 200){
                        e.TT && u.find('.item_title input').addClass('active').val(e.TT), a(u, v, e.HT), e.FB == 1 && setTimeout((function(){FB.XFBML.parse()}), 1e3), g(w)
                      } else {
                        k(f(m, !1), o, e.E, w)
                      }
                    }))
      }), d.click(function(){
        var w = $(this),
            u = w.siblings('.text-error');
        l && (s(!1, u, w), f(w, !0).addClass('spinner-is-loading'), $.post(paper.url.entry+"?token="+paper.token, {type: d.index(w)}, function(e){
                  if(e.S == 200) {
                  	g(w), $('#entries').append(e.HT), e.TP == 'text' && j(), e.TP == 'video' && $('#type').val('video'), f($('.btn_post'), !0)
                  } else k(!1, u, e.E, w);
                }))
      }), j()
    })()
})(paper);