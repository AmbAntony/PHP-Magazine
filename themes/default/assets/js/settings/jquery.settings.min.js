// +------------------------------------------------------------------------+
// | @author Oscar GarcÃ©s (SoyVillareal)
// | @author_url 1: https://soyvillareal.com
// | @author_url 2: https://github.com/soyvillareal
// | @author_email: hi@soyvillareal.com   
// +------------------------------------------------------------------------+
// | PHP Magazine - The best digital magazine for newspapers or bloggers
// | Licensed under the MIT License. Copyright (c) 2022 PHP Magazine.
// +------------------------------------------------------------------------+
(function(){var e,t,a,r,n,s,i=$("#content-vemail"),o=function(e){e.removeClass("hidden")},l=function(e){e.toggleClass("hidden")},d=function(e,t){e.attr("disabled",t)},c=function(e){e.removeClass("spinner-is-loading"),d(e,!0)};e=$("#username"),t=function(e){e.removeClass("border-red boxshadow-red")},a=function(e){e.addClass("border-red boxshadow-red")},r=function(e,t){var r=e.parent(),n=r.next().find(".btn_save");r.addClass("spinner-is-loading"),$.post(paper_s.url.validate+"?token="+paper_s.token,t,function(t){200==t.S?(c(r),d(n,!0),e.siblings(".text-error").text(t.E),a(e)):(c(r),d(n,!1))})},n=function(e,t=""){e.addClass("color-red").removeClass("color-green").text(t)},s=paper_s.arr_birthday,function(){var i=$("body"),c=$("#btn-adelete"),p=$("#alert-delete");$(".item_input").on("keyup, input",function(){var i=$(this),o=$("#text-count"),l=o.parent(),p=i.parents("form"),_=p.find(".text-error"),u=i.attr("data-send"),f=p.find(".btn_save"),v=i.val(),m=v.length;if(n(_),t(p.find(".item_input")),"username"==u)v.match(/^[a-zA-Z0-9]+$/)?r(e,{username:v}):m>0&&(_.text("*"+paper_s.word.write_only_numbers_letters),a(e)),m>16&&i.val(v.slice(0,16));else if("new_email"==u)r(i,{email:v});else if("birthday"==u){if(3==s.length){var x=i.attr("id");s["day"==x?0:"month"==x?1:2]=parseInt(v),d(f,!1)}if("month"==x||"year"==x){var h=$("#day"),b=h.val();h.html("<option value disabled selected>"+paper_s.word.year+"</option>");for(var w=1;w<=new Date($("#year").val(),$("#month").val(),0).getDate();w++){var g=$("<option>");g.attr("value",w).text(w),w==b&&g.attr("selected",!0),h.append(g)}}}else if("about"==u){var k=paper_s.settings.max_words_about;m>.8*k?l.addClass("color-red").removeClass("color-green color-orange"):m>.5*k?l.addClass("color-orange").removeClass("color-red color-green"):l.addClass("color-green").removeClass("color-red color-orange"),o.text(m),i.val(v.slice(0,k-1))}else"delete_account"==u&&d(c,!(v===paper_s.word.DELETE_COMMAND));-1!=["username","new_email","gender","birthday"].indexOf(u)&&""==v?(_.text("*"+paper_s.word.this_field_is_empty),a(i),d(f,!0)):d(f,!1),m>0?i.addClass("active"):i.removeClass("active")}),c.click(function(){o(p),i.addClass("overflow-hidden")}),$("#btn-cancel").click(function(){l(p),i.removeClass("overflow-hidden")}),$("#btn-delete").click(function(){var e=$(this),t=c.parents("form"),a=t.find(".text-error"),r=t.find("input");n(a),d(e.addClass("spinner-is-loading"),!0),$.post(paper_s.url.delete_account+"?token="+paper_s.token,{user_id:paper_s.user_id,delete_command:r.val()},function(t){200==t.S?window.location.href=t.UR:(r.val("").removeClass("active"),n(a,t.E),d(c,!0),d(e.removeClass("spinner-is-loading"),!1),l(p),i.removeClass("overflow-hidden"))})})}(),$(".ishow_check").change(function(){var e=$(this),t=e.parents("form"),a=e.attr("data-send"),r=t.find(".text-error"),s=t.find(".btn_save");d(s,!0),d(e,!0),$.post(paper_s.url.shows+"?token="+paper_s.token,{user_id:paper_s.user_id,input:a,show:e.is(":checked")},function(t){200==t.S?(r.addClass("color-green").text(t.M),setTimeout(function(){n(r),d(s,!1),d(e,!1)},3e3)):n(r,t.E)})}),$(".btn_save").click(function(e){e.preventDefault();var r=$(this),i=r.parents("form"),o=r.parents(".container_collapse"),p=i.find(".item_input"),_=i.find(".text-error"),u=$(".text_email"),f=$("#email-alert"),v=p.attr("data-send"),m="birthday"!=v?p.val():JSON.stringify(s);n(_),r.addClass("spinner-is-loading"),d(r,!0),$.post(paper_s.url.account+"?token="+paper_s.token,{user_id:paper_s.user_id,input:v,value:m},function(e){200==e.S?(o.find(".text_label").html(e.M),l(o.find(".content_cheader")),l(o.find(".content_citems")),t(p),c(r),"new_email"==v&&(1==e.EQ?($(u[0]).attr("class","text_email display-block"),$(u[1]).attr("class","text_email display-flex"),f.text(e.EM)):($(u[0]).attr("class","text_email display-flex"),$(u[1]).attr("class","display-inline-block ellipsis-horizontal"),f.text(e.EM)),1==e.EV&&l($("#btn-show-verify"))),"username"==v&&(p.attr("readonly",!0),$("#username-alert").text(e.EM)),"birthday"==v&&(d(p,!0),$("#birthday-alert").text(e.EM)),"newsletter"==v&&$("#newsletter-alert").html(e.HT)):(_.text(e.E),a(p),c(r))})}),$(".btn_collapse, .btn_ccancel").click(function(){var e=$(this),a=e.parents(".container_collapse"),r=e.parents("form"),n=r.find(".item_input"),s=r.find(".ishow_check"),i=r.find(".text-error");l(a.find(".content_cheader")),l(a.find(".content_citems")),i.text(""),s.length>0&&d(s,!1),t(n),"normal"!=paper_s.user_type&&(o($("#content-disconnect")),l(r))}),$("#btn-show-verify, .btn_vcancel").click(function(){var e=$(this).parents(".container_collapse");l(i),l(e.find(".content_cheader"))}),$(".btn_cgeneral").click(function(){var e=$(this).parents(".container_cgeneral");l(e.find(".content_cgitems")),$(this).find("svg").toggleClass("rotate-180")}),function(){var e=$("#btn-upload"),t=$("#upload-file"),a=$("#btn-ucancel"),r=$("#content-avatar img"),n=e.parent().siblings(".text-error"),s=function(t){o(r.attr("src",t)),u=!0,f=!0,e.text(paper_s.word.upload),n.text(""),o(a.text(paper_s.word.cancel)),e.blur()},l=function(e){e.addClass("hidden")},p=paper_s.user_avatar_s,_=paper_s.default_holder,u=!1,f=!1,v=0;"normal"!=paper_s.user_type&&$("#btn-disconnect").click(function(){var e=$(this).parent();e.siblings("form").removeAttr("class"),l(e)}),e.click(function(){u?(v=new FormData,v.append("user_id",paper_s.user_id),v.append("avatar",t.prop("files")[0]),d(e.text(paper_s.word.please_wait),!0),n.text(""),$.ajax({url:paper_s.url.upload_avatar+"?token="+paper_s.token,type:"POST",data:v,contentType:!1,processData:!1,success:function(s){200==s.S?(t.val(""),d(e.text(s.EM),!1),_=1,p=s.AV,a.text(s.ED),u=!1,f=!1,o(a)):(t.val(""),d(e.text(s.EM),!1),1==s.DH&&(a.text(s.ED),f=!1),u=!1,r.attr("src",p),n.text(s.E))}})):t.trigger("click")}),t.change(function(){var e=$(this),t=e.prop("files");if(t&&t[0]){var a=new FileReader;a&&a.readAsDataURL?(a.readAsDataURL(t[0]),$(a).on("load",function(){s(a.result)})):window.URL.createObjectURL&&s(window.URL.createObjectURL(t[0]))}}),a.click(function(){f?(r.attr("src",p),t.val(""),u=!1,f=!1,e.text(paper_s.word.upload_a_picture),a.text(paper_s.word.delete),n.text(""),0==_&&l(a)):(d(a.text(paper_s.word.please_wait),!0),n.text(""),$.post(paper_s.url.reset_avatar+"?token="+paper_s.token,{user_id:paper_s.user_id},function(t){200==t.S?(_=0,p=t.AV,r.attr("src",p),e.text(t.EM),l(a),a.text(t.ED),d(a,!1),e.blur()):n.text(t.E)}))}),$("#btn-verify-email").click(function(){var e=$(this),t=e.siblings(".text-error"),a=i.children();t.text(""),d(e.addClass("spinner-is-loading"),!0),$.post(paper_s.url.send_code+"?token="+paper_s.token,{user_id:paper_s.user_id},function(r){200==r.S?l($(a[0]),o($(a[1])),c(e)):(t.text(r.E),c(e))})})}()})(paper_s);