// +------------------------------------------------------------------------+
// | @author Oscar GarcÃ©s (SoyVillareal)
// | @author_url 1: https://soyvillareal.com
// | @author_url 2: https://github.com/soyvillareal
// | @author_email: hi@soyvillareal.com   
// +------------------------------------------------------------------------+
// | PHP Magazine - The best digital magazine for newspapers or bloggers
// | Licensed under the MIT License. Copyright (c) 2022 PHP Magazine.
// +------------------------------------------------------------------------+
(function(){var e,r,t=$("#content-newsletter"),s=$("#personalize-newsletter"),n=$("#content-error"),o=t.find(".item_place"),a=$("#unsubscribe-popup"),l=a.find(".text-error"),i=$("#btn-unsubscribe"),d=$("#other"),c=function(e,r,t){e.removeClass("spinner-is-loading"),u(r,t)},p=function(e){e.addClass("spinner-is-loading"),u(e,!0)},u=function(e,r){e.attr("disabled",r)};paper_sn.newsletter_exists&&(e=$("#btn-popup"),r=$("#reason"),e.click(function(){a.removeClass("hidden"),u(e,!0),u(o.slice(0,-4),!0),e.attr("aria-expanded",!0),e.blur()}),$("#btn-cancel").click(function(r){a.addClass("hidden"),u(e,!1),u(o.slice(0,-4),!1),e.attr("aria-expanded",!1)}),i.click(function(){p(i),$.post(paper_sn.url.unsubscribe+"?token="+paper_sn.token,{slug:paper_sn.slug,reason:"other"==r.val()?d.val():r.val()},function(e){200==e.S?(c(i,o,!0),n.removeClass("border-red color-red").addClass("border-green color-green"),setTimeout(function(){a.addClass("hidden"),n.text(e.M)},300),setTimeout(function(){window.location=paper_sn.loggedin?paper_sn.url.settings:paper_sn.url.newsletter},3300)):(l.text(e.E),c(i,i,!0))})})),function(){var e=$("#btn-newsletter"),r=$("#newsletter-email"),a=r.siblings(".text-error"),v=$("#newsletter-category"),g=t.find(".text_all"),f=t.find(".text_none"),C=function(){s.css("height",s.children().first().height())},h=function(e){e.removeClass("border-red boxshadow-red")},m=function(){g.toggleClass("hidden"),f.toggleClass("hidden"),_=!_},_=paper_sn.count_exists;(function(){var n=v.children(),c=$("#text-rcount"),p=c.parent(),b=d.parent();t.find(".select_all").click(function(){n.prop("selected",_),m(),u(e,!1),$(this).blur()}),o.on("keyup, change, input",function(){var t=$(this),o=t.attr("id"),d=t.val(),v=d.length;if("newsletter-email"==o)v>0?(h(t.addClass("active")),a.text(""),u(e,!1)):t.removeClass("active");else if("other"==o){var m=paper_sn.settings.max_words_unsub_newsletter;v>0?(h(t.addClass("active")),l.text(""),u(i,!1)):t.removeClass("active"),v>.8*m?p.addClass("color-red").removeClass("color-green color-orange"):v>.5*m?p.addClass("color-orange").removeClass("color-red color-green"):p.addClass("color-green").removeClass("color-red color-orange"),c.text(v),t.val(d.slice(0,m-1))}else"reason"==o?"other"==d?(b.removeClass("hidden"),p.removeClass("hidden")):(b.addClass("hidden"),p.addClass("hidden")):"newsletter-type"==o?"personalized"==d?C():s.removeAttr("style"):"newsletter-category"==o&&(n.length==v?(g.addClass("hidden"),f.removeClass("hidden"),_=!1):(g.removeClass("hidden"),f.addClass("hidden"),_=!0));(v>0||"newsletter-category"==o)&&(paper_sn.newsletter_exists&&"reason"!=o&&"other"!=o||!paper_sn.newsletter_exists&&""!=r.val())&&u(e,!1)})})(),function(){var l=$("#newsletter-type"),i=$("#newsletter-popular"),d=function(e){e.removeClass("border-green color-green").addClass("border-red color-red")},g=function(r){c(e,o,!0),n.removeClass("border-red color-red").addClass("border-green color-green"),setTimeout(function(){n.text(r)},300)},f=function(){s.removeAttr("style"),t.trigger("reset")};e.click(function(){var t=l.val();p(e),a.text(""),h(r),paper_sn.newsletter_exists?$.post(paper_sn.url.update+"?token="+paper_sn.token,{slug:paper_sn.slug,type:t,frequency:$("#newsletter-frequency").val(),popular:i.is(":checked"),cats:JSON.stringify(v.val())},function(r){200==r.S?(g(r.M),setTimeout(function(){n.text(""),d(n),"all"==t&&(f(),l.val("all"),i.prop("checked",!1)),u(o,!1),u(e,!1)},3300)):(d(n),n.text(r.E),e.removeClass("spinner-is-loading"))}):$.post(paper_sn.url.subscribe+"?token="+paper_sn.token,{email:r.val(),type:t,frequency:$("#newsletter-frequency").val(),popular:i.is(":checked"),cats:JSON.stringify(v.val())},function(t){200==t.S?(g(t.M),setTimeout(function(){r.removeClass("active"),n.text("").addClass("border-red color-red").removeClass("border-green color-green"),f(),m(),u(o,!1)},3300)):(a.text(t.E),r.addClass("border-red boxshadow-red"),e.removeClass("spinner-is-loading"))})})}(),"all"!=paper_sn.frequency&&setTimeout(C,500)}()})();