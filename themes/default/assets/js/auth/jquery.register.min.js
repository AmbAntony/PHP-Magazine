// +------------------------------------------------------------------------+
// | @author Oscar Garcés (SoyVillareal)
// | @author_url 1: https://soyvillareal.com
// | @author_url 2: https://github.com/soyvillareal
// | @author_email: hi@soyvillareal.com   
// +------------------------------------------------------------------------+
// | PHP Magazine - The best digital magazine for newspapers or bloggers
// | Licensed under the MIT License. Copyright (c) 2022 PHP Magazine.
// +------------------------------------------------------------------------+
(function(){var e,r,a,t,s,n=$("#btn-register"),o=$("#username").focus(),i=$("#email"),d=$("#password"),c=$("#re-password"),l=$("#accept-checkbox"),p=$(".item_input"),_=i.siblings(".text-error"),u=c.siblings(".text-error"),h=function(e){l.is(":checked")&&m(n,e)},g=function(e){e.addClass("border-red boxshadow-red")},m=function(e,r){e.attr("disabled",r)},v=function(e){m(e.removeClass("spinner-is-loading"),!1)},f=!0,w=!1;r=$("#fields-one"),a=$("#container-signup"),t=$("#fields-two"),s=function(e,r,a,t=""){w&&$.post(paper_are.url.register+"?token="+paper_are.token,{username:e,email:r,password:a,re_password:c.val(),recaptcha:t,accept_checkbox:$("#accept-checkbox:checked").val(),return_url:paper_are.return_url,return_param:paper_are.return_param},function(e){200==e.S?window.location=e.UR:(u.text(e.E),g(p),v(n))})},l.change(function(){var e=l.is(":checked");f&&(m(n,!e),h(!e))}),n.click(function(){var e=o.val(),c=i.val(),l=d.val(),p=function(e){g(e),e.siblings(".text-error").text("*"+paper_are.word.this_field_is_empty)};0==e.length?p(o):f?c.match(/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/)?0==c.length?(_.text("*"+paper_are.word.this_field_is_empty),g(i)):(a.addClass("has-back-button"),n.attr("type","submit").find("span").text(paper_are.word.create_account),r.addClass("hidden"),t.removeClass("hidden"),h(!0),d.focus(),f=!1):(_.text("*"+paper_are.word.enter_a_valid_email),g(i)):0==l.length?p(d):(m(n.addClass("spinner-is-loading"),!0),"on"==paper_are.recaptcha?grecaptcha.ready(function(){grecaptcha.execute(paper_are.reCAPTCHA_site_key,{action:"register"}).then(function(r){s(e,c,l,r)})}):s(e,c,l))}),$("#btn-back-email").click(function(){a.removeClass("has-back-button"),n.attr("type","button").find("span").text(paper_are.word.next),t.addClass("hidden"),r.removeClass("hidden"),h(!1),i.focus(),f=!0}),e=$("#supported-symbols"),$("#show-symbols").click(function(){var r=$(this),a=JSON.parse(r.attr("aria-expanded"));a?e.removeAttr("style"):e.css("height",e.children().first().height()),r.attr("aria-expanded",!a)}),function(){var e=$("#text-validate"),r=function(e){e.removeClass("border-red boxshadow-red")};p.on("keyup, input",function(){var a=$(this),t=a.attr("id"),s=o.val(),n=c.val(),l=a.val(),p=o.siblings(".text-error"),m=$("#valid-password").children(),x=function(){$(m.splice(0,2)).addClass("border-orange"),e.text(paper_are.word.password_security_half)},b=function(e,r){e?r.removeClass("color-grey").addClass("color-green"):r.removeClass("color-green").addClass("color-grey")},C=function(){m.removeClass("border-red border-orange border-green")},k=function(e,r){var a=e.parent();a.addClass("spinner-is-loading"),$.post(paper_are.url.validate+"?token="+paper_are.token,r,function(r){200==r.S?(v(a),e.siblings(".text-error").text(r.E),g(e)):v(a)})};"username"==t?(p.text(""),r(o),s.match(/^[a-zA-Z0-9]+$/)?(k(o,{username:s}),h(!1)):s.length>0&&(p.text("*"+paper_are.word.write_only_numbers_letters),g(o),h(!0)),l.length>16&&a.val(l.slice(0,16))):"email"==t?(_.text(""),r(i),k(i,{email:i.val()})):"password"==t?f||(u.text(""),h(!0),r(c.val("").removeClass("active")),C(),l.match(/^(?=.{12,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*[¡!\"#$%&'()*+,-./:;<=>¿?@\]\[^_`{|}~]).*$/)?(m.addClass("border-green"),e.text(paper_are.word.password_security_strong)):l.match(/^(?=.{8,})(?=.*[a-z])(?=.*[0-9])(?=.*[¡!\"#$%&'()*+,-./:;<=>¿?@\]\[^_`{|}~]).*$/)?($(m.splice(0,3)).addClass("border-green"),e.text(paper_are.word.password_security_good)):l.match(/^(?=.{8,})(?=.*[¡!\"#$%&'()*+,-./:;<=>¿?@\]\[^_`{|}~]).*$/)?x():l.match(/^(?=.{7,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$/)?x():($(m[0]).addClass("border-red"),e.text(paper_are.word.password_security_weak)),b(l.length>=8,$("#icon-five")),b(l.match(/[¡!"#$%&'()*+,-./:;<=>¿?@[\]^_`{|}~]/),$("#icon-supported")),0==l.length&&(C(),e.text(paper_are.word.write_a_password))):"re-password"==t&&(n.length>0&&d.val()!=n?(u.text("*"+paper_are.word.passwords_not_match),g(c),h(!0),w=!1):(u.text(""),r(c),n.length>0?h(!1):h(!0),w=!0)),l.length>0?a.addClass("active"):a.removeClass("active")})}()})(paper_are);